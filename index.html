<!doctype html>
<html lang="es">
<head>
  <link rel="icon" href="ima/icono1.png" type="image/png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buscar Rutas - Transporte</title>
  <style>
    :root{
      --primary:#378f04b0;
      --accent:#ce1010;
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f1720;
      --muted:#6b7280;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, Arial; margin:0; background:var(--bg); color:var(--text);}

    header{
      background:linear-gradient(90deg,var(--primary),#0a93d0);
      color:#fff;
      padding:14px 16px;
      display:flex;
      align-items:center;
      gap:12px;
      position:sticky;
      top:0;
      z-index:900
    }
    .hamburger{font-size:26px; cursor:pointer;}
    .brand{font-weight:800; font-size:18px}
    .clock{margin-left:auto; font-weight:700; background:rgba(255,255,255,0.12); padding:6px 10px; border-radius:10px}

    .side-banner{position:fixed; top:0; right:0; width:140px; height:100vh; overflow:hidden; border-left:6px solid rgba(0,0,0,0.04); background:#fff; z-index:100}
    .side-banner-left{left:0; right:auto; border-left:0; border-right:6px solid rgba(0,0,0,0.04)}
    .side-banner .slides img{width:100%; height:100%; object-fit:cover; position:absolute; opacity:0; transition:opacity .6s}
    .side-banner .slides img.active{opacity:1}

    body{padding:0 140px 40px 140px}
    @media(max-width:900px){
      .side-banner{display:none}
      body{padding:0 12px}
    }

    .container{max-width:980px; margin:18px auto}
    .card{background:var(--card); padding:18px; border-radius:var(--radius); box-shadow:0 8px 30px rgba(11,127,191,0.06)}

    .search-row{display:flex; gap:10px; align-items:center}
    .search-row input[type=text]{flex:1; padding:12px 14px; border-radius:10px; border:1px solid #e6eef8; font-size:16px}
    .search-row button{background:var(--primary); color:#fff; border:none; padding:12px 14px; border-radius:10px; cursor:pointer; font-weight:700}

    .info-box{margin-top:14px; padding:12px; border-radius:10px; background:#fbfcff; border:1px solid #eef6fb}

    .results{margin-top:16px}
    .route{padding:12px; border-radius:10px; border:1px solid #eef6fb; margin-bottom:10px; background:white}
    .route h3{margin:0 0 6px}
    .meta{font-size:13px; color:var(--muted)}

    /* MAPA */
    #map{
      height:450px;
      width:100%;
      border-radius:10px;
      border:1px solid #e6eef8;
      margin-top:16px;
    }

    .menu{position:fixed; left:0; top:0; bottom:0; width:260px; background:#fff; padding:18px; transform:translateX(-110%); transition:transform .28s; z-index:1000; box-shadow:0 30px 60px rgba(2,6,23,0.12)}
    .menu.open{transform:translateX(0)}
    .menu a{display:block; padding:10px 6px; color:var(--text); text-decoration:none; font-weight:600}

    .overlay{position:fixed; inset:0; background:rgba(0,0,0,0.35); display:none; z-index:999}
    .overlay.show{display:block}

    footer{max-width:980px; margin:12px auto; color:var(--muted); font-size:13px; text-align:center}
    select{padding:8px; border-radius:8px; border:1px solid #e6eef8}
  </style>
</head>
<body>

  <div class="menu" id="menu">
    <strong>Men√∫</strong>
    <a class="tab" href="buzon.html">üì¨ Buz√≥n</a>
    <a href="conocenos.html">üìò Qui√©nes somos</a>
    <a href="escuelas.html">üè´ Escuelas</a>
    <a href="contacto.html">üìû Contacto</a>
  </div>
  <div class="overlay" id="overlay"></div>

  <header>
    <div class="hamburger" id="hamb">‚ò∞</div>
    <div class="brand">Rutas MX</div>
    <div class="clock" id="clock">--:--:--</div>
  </header>

  <div class="side-banner side-banner-left" id="side-left">
    <div class="slides"></div>
  </div>
  <div class="side-banner" id="side-right">
    <div class="slides"></div>
  </div>

  <div class="container">
    <div class="card" id="buscar">
      <h2>Buscar rutas de transporte</h2>
      <p class="info-box">Escribe el nombre de la ruta o una parada. Ej.: <em>Ruta 5</em> o <em>Terminal Central</em></p>

      <div class="search-row">
        <input type="text" id="q" placeholder="Escribe ruta o parada..." />
        <button id="searchBtn">Buscar</button>
        <div style="margin-left:8px" class="flex">
          <select id="turnoSelect">
            <option value="all">Todos los turnos</option>
            <option value="matutino">Matutino</option>
            <option value="vespertino">Vespertino</option>
          </select>
          <select id="rutaPick">
            <option value="">-- Selecciona ruta --</option>
          </select>
          <button id="showRouteBtn">Mostrar</button>
        </div>
      </div>

      <div class="results" id="results">
        <div class="meta" style="margin-top:10px">Sin resultados a√∫n. Realiza una b√∫squeda.</div>
      </div>

      <div id="map"></div>

    </div>
  </div>

  <footer>¬© PROTECTO SCHOOL RIDE ‚Äî PROCEDIMIENTO Y TRABAJO BASE HTML.</footer>

<script>
/* ---------------- RUTAS NORMALIZADAS ---------------- */

const ROUTES = [
  { id:'M1', turno:'matutino', name:'Nueva Era', stops:['IMSS Eva S√°mano','Escuela Himno Nacional Nueva Era'], times:['07:30','15:00'] },
  { id:'M2', turno:'matutino', name:'Centro y Torres', stops:['Chedraui Washington','Smart L√≥pez de Lara','Vidrios y Cristales Las Torres','Mar√≠a de la Luz y Rastro Municipal'], times:['07:30','15:00'] },
  { id:'M3', turno:'matutino', name:'Kil√≥metros y Fresnos', stops:['Smart Colinas','Entrada a Palmares','Puente Peatonal El Faro','Gasolinera Pemex Carr. Nacional','Aeropuerto y Anzures'], times:['07:30','15:00'] },
  { id:'M4', turno:'matutino', name:'Villas y Oradel', stops:['Oxxo Villas San Miguel','Oxxo San Armando y Blvd San Patricio','Oradel Campanario','Oxxo Memphis y Berna'], times:['07:30','15:00'] },
  { id:'M5', turno:'matutino', name:'Colorines y Valles', stops:['Secundaria 80 Rea y Prometeo','Oxxo Colorines Rea y Cl√≠o','Valles de An√°huac Calle 22 y 5a Ave'], times:['07:30','15:00'] },
  { id:'M6', turno:'matutino', name:'Olivos', stops:['Prestigio y Estados Unidos','Rea y M√©rito','Oxxo Rea y Triunfo','Canseco y Gonz√°lez'], times:['07:30','15:00'] },
  { id:'M7', turno:'matutino', name:'Revoluci√≥n Tuxpan', stops:['Revoluci√≥n y Tuxpan','Entrada a Lomas del R√≠o'], times:['07:30','15:00'] },
  { id:'M8', turno:'matutino', name:'Reservas', stops:['Rea y Poseid√≥n','Canseco y Prometeo'], times:['07:30','15:00'] },
  { id:'M9', turno:'matutino', name:'Reservas BIS', stops:['Rea y Poseid√≥n','Canseco y Prometeo'], times:['07:30','15:00'] },
  { id:'M10', turno:'matutino', name:'Solidaridad', stops:['Eva S√°mano y Revoluci√≥n','Eva S√°mano y R√≠o Colorado','Revoluci√≥n y R√≠o Verde'], times:['07:30','15:00'] },
  { id:'M11', turno:'matutino', name:'Voluntad y Joya', stops:['Aeropuerto y Guti√©rrez','Aeropuerto y R√≠o Verde','Smart Revoluci√≥n','R√≠o Nilo y Mayas'], times:['07:30','15:00'] },
  { id:'M12', turno:'matutino', name:'Chapala', stops:['Rotonda UAT','Lago de Chapala y Sistemas','Iglesias Calder√≥n y Doroteo Arango'], times:['07:30','15:00'] },
  { id:'M13', turno:'matutino', name:'Chapala BIS', stops:['Rotonda UAT','Lago de Chapala y Sistemas','Iglesias Calder√≥n y Doroteo Arango','Ferreter√≠a Elizondo Emilio Madero'], times:['07:30','15:00'] },

  { id:'V1', turno:'vespertino', name:'Reforma Walmart', stops:['Soriana Reforma','Walmart Casa del Adulto Mayor','Lago de Chapala y Sistemas','Iglesias Calder√≥n y Doroteo Arango'], times:['17:00','21:30'] },
  { id:'V2', turno:'vespertino', name:'Joya Carrizo', stops:['Aeropuerto y Dr. Mier','Dr. Mier y Mazatl√°n Oxxo','Soriana Carrizo','Revoluci√≥n y Tuxpan','R√≠o Nilo y Mayas','Valles de An√°huac Calle 22'], times:['17:00','21:30'] },
  { id:'V3', turno:'vespertino', name:'Reservas Colorines', stops:['Oxxo Rea y Triunfo','Oxxo Rea y Cl√≠o','Carlos Canseco y Prometeo'], times:['17:00','21:30'] },
  { id:'V4', turno:'vespertino', name:'Hidalgo Centro', stops:['Gonz√°lez y Parque Narciso Mendoza','Guerrero y H√©roes de Nacataz','Per√∫ y Calle Am√©rica','Chedraui Hip√≥dromo'], times:['17:00','21:30'] },
  { id:'V5', turno:'vespertino', name:'La Fe Villas', stops:['Soriana La Fe','Rotonda Villas San Miguel','Campanario y R√≠o Bravo','Oxxo Memphis y Berna'], times:['17:00','21:30'] },
  { id:'V6', turno:'vespertino', name:'Olivos Voluntad', stops:['Oxxo Rea y Triunfo','R√≠o Nilo y Mayas','Entrada a Lomas del R√≠o'], times:['17:00','21:30'] }
];

/* ---------------- MAPA ---------------- */

let map, geocoder, markers=[], polyline=null;
const colors = ["#0066ff","#ff3b30","#ff9500","#34c759","#5856d6","#ff2d55","#5ac8fa","#4cd964"];

function initMap(){
  map = new google.maps.Map(document.getElementById("map"), {
    center:{lat:27.476, lng:-99.55},
    zoom:12
  });
  geocoder = new google.maps.Geocoder();
  populateRouteSelector();
}

function geocode(address){
  return new Promise(resolve=>{
    geocoder.geocode({address: address + " Nuevo Laredo"}, (results, status)=>{
      if(status==="OK" && results?.[0]) resolve(results[0].geometry.location);
      else resolve(null);
    });
  });
}

async function drawRouteById(id){
  const r = ROUTES.find(x=>x.id===id);
  if(!r) return alert("Ruta no encontrada");

  if(polyline) polyline.setMap(null);
  markers.forEach(m=>m.setMap(null));
  markers=[];

  const coords = [];
  for(const s of r.stops){
    const loc = await geocode(s);
    if(loc){
      coords.push({lat:loc.lat(), lng:loc.lng()});
      const m = new google.maps.Marker({position:loc, map, title:s});
      markers.push(m);
    }
  }

  if(coords.length>=2){
    polyline = new google.maps.Polyline({
      path: coords,
      geodesic:true,
      strokeColor: (r.turno === "matutino") ? "#0066FF" : "#FF3333",
      strokeWeight:5,
      strokeOpacity:0.95
    });
    polyline.setMap(map);
    map.panTo(coords[0]);
    map.setZoom(13);
  }

  resultsEl.innerHTML = `
    <div class="route">
      <h3>${r.name} <small class="meta">(${r.id})</small></h3>
      <div class="meta">Turno: ${r.turno} ‚Ä¢ Horario: ${r.times.join(" - ")}</div>
      <div class="meta">Paradas: ${r.stops.join(" ¬∑ ")}</div>
    </div>
  `;
}

function hashCode(str){ let h=0; for(let i=0;i<str.length;i++) h=((h<<5)-h)+str.charCodeAt(i); return h; }

/* ---------------- B√öSQUEDA ---------------- */

const qInput = document.getElementById('q');
const resultsEl = document.getElementById('results');

function populateRouteSelector(){
  const sel = document.getElementById('rutaPick');
  sel.innerHTML = '<option value="">-- Selecciona ruta --</option>';
  ROUTES.forEach(r=>{
    const opt = document.createElement('option');
    opt.value = r.id;
    opt.textContent = `[${r.turno[0].toUpperCase()}] ${r.name} (${r.times.join("-")})`;
    sel.appendChild(opt);
  });
}

document.getElementById('showRouteBtn').addEventListener('click', ()=>{
  const id = document.getElementById('rutaPick').value;
  if(!id) return alert("Selecciona una ruta");
  drawRouteById(id);
});

document.getElementById('turnoSelect').addEventListener('change', (e)=>{
  const turno = e.target.value;
  const sel = document.getElementById('rutaPick');
  sel.innerHTML = '<option value="">-- Selecciona ruta --</option>';
  ROUTES.filter(r=> turno==='all' ? true : r.turno===turno)
        .forEach(r=>{
          const opt = document.createElement('option');
          opt.value = r.id;
          opt.textContent = `[${r.turno[0].toUpperCase()}] ${r.name} (${r.times.join("-")})`;
          sel.appendChild(opt);
        });
});

function search(query){
  query = (query||'').trim().toLowerCase();
  if(!query){
    resultsEl.innerHTML = '<div class="meta">Escribe algo para buscar.</div>';
    return;
  }

  const matches = ROUTES.filter(r=> 
    r.name.toLowerCase().includes(query) ||
    r.id.toLowerCase()===query ||
    r.stops.some(s=> s.toLowerCase().includes(query))
  );

  if(matches.length===0){
    resultsEl.innerHTML = '<div class="meta">No se encontraron rutas coincidentes.</div>';
    return;
  }

  resultsEl.innerHTML = '';
  matches.forEach((r)=>{
    const div = document.createElement('div');
    div.className = 'route';
    div.innerHTML = `
      <h3>${r.name} <small class="meta">(${r.id})</small></h3>
      <div class="meta">Turno: ${r.turno} ‚Ä¢ Horario: ${r.times.join(" ‚Ä¢ ")}</div>
      <div class="meta">Paradas: ${r.stops.join(' ¬∑ ')}</div>
      <div style="margin-top:8px">
        <button data-id="${r.id}" class="showBtn">Mostrar en mapa</button>
      </div>
    `;
    resultsEl.appendChild(div);
  });

  document.querySelectorAll('.showBtn').forEach(b=>{
    b.addEventListener('click', e=>{
      const id = e.currentTarget.getAttribute('data-id');
      drawRouteById(id);
    });
  });
}

document.getElementById('searchBtn').addEventListener('click', ()=> search(qInput.value));
qInput.addEventListener('keydown', e=>{ if(e.key==='Enter') search(qInput.value); });

/* ---------------- Reloj ---------------- */
function updateClock(){ document.getElementById('clock').textContent = new Date().toLocaleTimeString(); }
setInterval(updateClock,1000); updateClock();

/* ---------------- Banners ---------------- */
function populateBanner(bannerId, images){
  const slides = document.getElementById(bannerId).querySelector('.slides');
  slides.innerHTML = '';
  images.forEach((src,i)=>{
    const img = document.createElement('img');
    img.src = src;
    if(i===0) img.classList.add('active');
    slides.appendChild(img);
  });
}
populateBanner('side-left', ['ima/IMG2.jpeg','ima/IMG3.jpeg']);
populateBanner('side-right', ['ima/IMG1.jpeg','ima/IMG2.jpeg']);

function startBannerSlideshow(bannerId, interval=3000){
  setInterval(()=>{
    const imgs = document.getElementById(bannerId).querySelectorAll('.slides img');
    if(imgs.length<=1) return;
    let i = [...imgs].findIndex(img=>img.classList.contains('active'));
    imgs[i].classList.remove('active');
    i = (i+1)%imgs.length;
    imgs[i].classList.add('active');
  }, interval);
}
startBannerSlideshow('side-left');
startBannerSlideshow('side-right');

/* ---------------- Men√∫ ---------------- */
const hamb = document.getElementById('hamb');
const menu = document.getElementById('menu');
const overlay = document.getElementById('overlay');

function toggleMenu(open){
  menu.classList.toggle('open', open);
  overlay.classList.toggle('show', open);
}

hamb.addEventListener('click', ()=> toggleMenu(!menu.classList.contains('open')));
overlay.addEventListener('click', ()=> toggleMenu(false));

</script>

<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC13gZAM4OVtdJCkNvbcRDSdCDBY4xNwhc&callback=initMap&libraries=places"></script>

</body>
</html>
